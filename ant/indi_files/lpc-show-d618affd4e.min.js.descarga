/*global REG, APP */
!function(){"use strict";function getEmail(paramsStr){var parts=paramsStr.split("&"),email=null;return parts.forEach(function(part,index){var parts2=part.split("=");"email"===parts2[0]&&(email=parts2[1])}),email}function sortByRectTop(a,b){return a.rect.top<b.rect.top?-1:a.rect.top>b.rect.top?1:0}function FormElement(form){this.form=form,this.init()}function Forms(){}function stopYTAutoPlay(){var allVideo=document.querySelectorAll('[data-editable="video"] iframe'),ln=allVideo.length,src,i;for(i=0;i<ln;i+=1)src=allVideo[i].src.replace(/autoplay=1/i,"autoplay=0"),src=src.replace("autoPlay",""),allVideo[i].src=src}function setMinHeightWhenOneSection(){var allSection=document.querySelectorAll("#Preview > section");if(!(1<allSection.length)){var height=parseInt(window.getComputedStyle(allSection[0],"").height,10);(isNaN(height)||height<1365)&&(allSection[0].style.minHeight="1365px")}}var ARRAY=Array.prototype,FieldElement,rxErrorRemove=new RegExp("(?:^|\\s+)error"),rxErrorHas=new RegExp("(^|\\s+)error(\\s+|$)"),errorClassName="error",propertiesList=["type","name","id"];Array.from||(Array.from=function(){var toStr=Object.prototype.toString,isCallable=function(fn){return"function"==typeof fn||"[object Function]"===toStr.call(fn)},toInteger=function(value){var number=Number(value);return isNaN(number)?0:0!==number&&isFinite(number)?(number>0?1:-1)*Math.floor(Math.abs(number)):number},maxSafeInteger=Math.pow(2,53)-1,toLength=function(value){var len=toInteger(value);return Math.min(Math.max(len,0),maxSafeInteger)};return function from(arrayLike){var C=this,items=Object(arrayLike);if(null==arrayLike)throw new TypeError("Array.from requires an array-like object - not null or undefined");var mapFn=arguments.length>1?arguments[1]:void 0,T;if(void 0!==mapFn){if(!isCallable(mapFn))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(T=arguments[2])}for(var len=toLength(items.length),A=isCallable(C)?Object(new C(len)):new Array(len),k=0,kValue;k<len;)kValue=items[k],A[k]=mapFn?void 0===T?mapFn(kValue,k):mapFn.call(T,kValue,k):kValue,k+=1;return A.length=len,A}}()),FieldElement=function(){function Handles(field){this.field=field,this.init()}function FieldElement(element){var oThis=this,attrs=ARRAY.slice.call(element.attributes)||[],rect=element.getBoundingClientRect();this.element=element,this.parentNode=this.element.parentNode,this.rect={top:rect.top},function(_self){var fieldBlocker=_self.parentNode.querySelector(".field-blocker");fieldBlocker&&fieldBlocker.parentNode.removeChild(fieldBlocker)}(this),Object.defineProperties(this,{validationMessage:{get:function(){return this.element.getAttribute("data-error-msg")},set:function(value){this.element.setAttribute("data-error-msg",value)},enumerable:!0}}),attrs.forEach(function(attr){propertiesList.contains(attr.name)&&(oThis[attr.name]=attr.value)}),new Handles(this)}return Handles.blur=function(e){return this.notify("blur",e),!0},Handles.focus=function(e){return this.unsetErrorMessage(),this.notify("focus",e),!0},Handles.prototype={init:function(){var element=this.field.element;element.addEventListener("blur",Handles.blur.bind(this.field),!1),element.addEventListener("focus",Handles.focus.bind(this.field),!1)}},FieldElement.prototype=Object.create({on:function(name,action){this.observer||(this.observer={}),this.observer[name]||(this.observer[name]=[]),this.observer[name].contains(action)?this.observer[name][this.observer[name].indexOf(action)]=action:this.observer[name].push(action)},off:function(name,action){var ix;this.observer&&this.observer[name]&&-1<(ix=this.observer[name].indexOf(action))&&this.observer[name].splice(ix,1)},notify:function(name){var oThis=this,args;this.observer&&this.observer[name]&&(args=Array.prototype.slice.call(args),this.observer[name].forEach(function(fn){fn.apply(oThis,args)}))}}),FieldElement.prototype.reportValidity=function(msg){return msg?this.setErrorMessage(msg):this.unsetErrorMessage(),!!msg},FieldElement.prototype.setErrorMessage=function(customMessage){var parent=this.parentNode,$parent=$(parent),webformNewItem=$parent.parent('[data-editable="webformNewItem"]');customMessage=customMessage||this.validationMessage,customMessage?(parent.setAttribute("data-error-msg",customMessage),rxErrorHas.test(parent.className)||(parent.className=[parent.className,"error"].join(" ").trim()),webformNewItem.addClass("make-error-msg-visible")):this.unsetErrorMessage()},FieldElement.prototype.unsetErrorMessage=function(){var parent=this.parentNode,$parent=$(parent);$parent.removeAttr("data-error-msg"),$parent.removeClass(errorClassName),$parent.parent('[data-editable="webformNewItem"]').removeClass("make-error-msg-visible"),$parent.parent('[data-editable-item="field"]').find("label").each(function(index,el){var $el=$(el);$el.removeAttr("data-error-msg"),$el.removeClass(errorClassName)})},FieldElement.prototype.setZIndex=function(newZIndex){var $element=$(this.element),webformItem=$element.closest("[data-editable]");this.zIndex=newZIndex,webformItem[0]&&(webformItem[0].style.zIndex=newZIndex)},FieldElement}();var trackingHelper={sendTrackingEvent:function(){this.isFacebookPixelEnabled()?window.fbq("track","Lead"):this.isGoogleAnalyticsEnabled()?window.ga("send","event","Lead","registered",document.title):this.isMixPanelEnabled()?window.mixpanel.track("lead",{form:"register",lps_name:document.title}):this.isGoogleTagManagerEnabled()&&window.dataLayer.push({event:"Lead"})},sendAdWordsEvent:function(callback){var hasCallback="function"==typeof callback;if(this.isGoogleAdWordsEnabled()){var img=new Image;hasCallback&&(img.onload=function(){callback()}),img.src="//www.googleadservices.com/pagead/conversion/"+APP.initialData.google_adwords_id+"/?label="+APP.initialData.google_adwords_conversion_label+"&amp;guid=ON&amp;script=0"}else hasCallback&&callback()},hasInitialData:function(){return APP&&APP.initialData},isGoogleAdWordsEnabled:function(){return this.hasInitialData()&&""!==APP.initialData.google_adwords_id&&""!==APP.initialData.google_adwords_conversion_label},isFacebookPixelEnabled:function(){return this.hasInitialData()&&"facebook_pixel"===APP.initialData.tracking_code_type},isGoogleAnalyticsEnabled:function(){return this.hasInitialData()&&"google_analytics"===APP.initialData.tracking_code_type},isMixPanelEnabled:function(){return this.hasInitialData()&&"mixpanel"===APP.initialData.tracking_code_type},isGoogleTagManagerEnabled:function(){return this.hasInitialData()&&"google_tag_manager"===APP.initialData.tracking_code_type}};FormElement.prototype=Object.create({serialize:function(){var form=this.form,elements=ARRAY.slice.call(form.elements),q=[],noCustoms=["name","email","first_name","last_name","gr_conference_id"];return elements.forEach(function(element){var elementName=element.name;if(elementName){if("true"!==element.getAttribute("data-is-custom")&&-1!==noCustoms.indexOf(elementName)||elementName.indexOf("custom_")&&(elementName="custom_"+elementName),/^(text|textarea|hidden|password|button|reset|submit)$/i.test(element.type)){if(null!==element.getAttribute("data-country-code")){var directional=$(element).parents('[data-editable="webformNewItem"]').find('[data-feature-part="directional"] [data-feature-part="directional-container"]').html(),phoneNumber=directional+(element.value||"").replace(/\(|\)|-|\s/g,"");return void q.push(elementName+"="+encodeURIComponent(phoneNumber))}return void q.push(elementName+"="+encodeURIComponent(element.value))}if(/^(checkbox|radio)$/i.test(element.type))return void(element.checked&&q.push(elementName+"[]"+"="+encodeURIComponent(element.value)));/^select-(one|multiple)$/i.test(element.type)&&(ARRAY.slice.call(element.options)||[]).forEach(function(opt){opt.selected&&q.push(elementName+"[]"+"="+encodeURIComponent(opt.value))})}}),q.join("&")}}),FormElement.prototype.init=function(){var oThis=this;ARRAY.slice.call(this.form.elements).forEach(function(element){var field=new FieldElement(element);oThis[field.name]=field,ARRAY.push.call(oThis,field)});var formElements=Array.from(oThis);formElements.sort(sortByRectTop);for(var i=0;i<formElements.length;i++){formElements[i].setZIndex(formElements.length-i)}this.form.addEventListener("submit",function(e){return oThis.validate(),e.preventDefault(),e.stopPropagation(),!1},!1)},FormElement.prototype.validate=function(){var oThis=this,params,search=location.search,url;params=this.serialize(),url=search?search+"&"+params:"?"+params,delete this.errors;for(var requiredFieldsElements=Array.prototype.slice.call(this.form.querySelectorAll('[data-item-required="true"], [data-item-name="email"]')),errors={},i=0;i<requiredFieldsElements.length;i++){for(var requiredFieldElement=requiredFieldsElements[i],requiredFieldInputs=Array.prototype.slice.call(requiredFieldElement.querySelectorAll("input, select, textarea")),hasValue=!1,isCheckbox="webform_checkbox"===requiredFieldElement.getAttribute("data-item-type"),isRadio="webform_radio"===requiredFieldElement.getAttribute("data-item-type"),valueProp=isCheckbox||isRadio?"checked":"value",j=0;j<requiredFieldInputs.length;j++)requiredFieldInputs[j][valueProp]&&(hasValue=!0);hasValue||(errors[requiredFieldElement.getAttribute("data-item-name")]=APP.initialData.l10n.ModSqueezePageLPCCreatePageWebformWebformFieldsRequiredField)}if(Object.keys(errors).length)return oThis.errors=errors,void oThis.reportValidity();APP.io.post(url,{},function(json){json.error?(oThis.errors=json.error,oThis.reportValidity()):oThis.success(json.table,params)})},FormElement.prototype.createTYButton=function(){if("webformNew"===this.form.parentNode.getAttribute("data-editable")){var buttonEditable=this.form.querySelector('[data-editable="webformNewButton"]'),button=buttonEditable.querySelector('[type="submit"]'),fontColor=window.getComputedStyle(buttonEditable,"").color,register={value:button.value,innerHTML:button.innerHTML},checkmark='<svg height="'+75+'%" style="margin:auto auto;position:absolute;top:0;right:0;bottom:0;left:0;" viewBox="0 0 50 50" ><path fill="'+fontColor+'" d="M0.1,24.4l4.3-4c5,2.4,8.2,4.3,13.8,8.3c10.6-12,17.6-18.1,30.6-26.2l1.4,3.2 c-10.7,9.4-18.6,19.8-29.9,40.1C13.3,37.6,8.6,32.4,0.1,24.4z"/></svg>';button.disabled=!0,button.value=REG.thankyoutext,button.innerHTML=checkmark,setTimeout(function(){button.form.reset(),button.value=register.value,button.innerHTML=register.innerHTML,Array.prototype.slice.call(button.form.elements).forEach(function(element){element.focus(),element.blur()}),button.disabled=!1},2500)}else(function(){var buttonContainer=this.form.querySelector('[data-type="submit"]')||function(form){var items=form.getElementsByClassName("wf-item");return items[items.length-1]}(this.form),button=buttonContainer.querySelector('[type="submit"]'),register={value:button.value,innerHTML:button.children[0].innerHTML,wfItemPos:buttonContainer.children[0].style.cssText,wrapper:buttonContainer.children[0].children[0].style.cssText},fontColor=window.getComputedStyle(button.children[0],"").color,checkmark='<svg height="'+75+'%" style="margin:auto auto;position:absolute;top:0;right:0;bottom:0;left:0;" viewBox="0 0 50 50" ><path fill="'+fontColor+'" d="M0.1,24.4l4.3-4c5,2.4,8.2,4.3,13.8,8.3c10.6-12,17.6-18.1,30.6-26.2l1.4,3.2 c-10.7,9.4-18.6,19.8-29.9,40.1C13.3,37.6,8.6,32.4,0.1,24.4z"/></svg>';button.disabled=!0,button.value=REG.thankyoutext,button.children[0].innerHTML=checkmark,setTimeout(function(){button.form.reset(),button.value=register.value,button.children[0].innerHTML=register.innerHTML;try{buttonContainer.children[0].style.cssText=register.wfItemPos,buttonContainer.children[0].children[0].style.cssText=register.wrapper}catch(ex){buttonContainer.children[0].style.setAttribute&&(buttonContainer.children[0].style.setAttribute("cssText",register.wfItemPos),buttonContainer.children[0].children[0].style.setAttribute("cssText",register.wrapper))}Array.prototype.slice.call(button.form.elements).forEach(function(element){element.focus(),element.blur()}),button.disabled=!1},2500)}).call(this)},FormElement.prototype.success=function(answer,params){if(answer){var email=getEmail(params);switch("undefined"===document.cookie.replace(/(?:(?:^|.*;\s*)visitorId\s*\=\s*([^;]*).*$)|^.*$/,"$1")&&email&&window.gaSetUserId&&window.gaSetUserId(email),REG.thankyouurl){case"stay":this.createTYButton(),trackingHelper.sendTrackingEvent(),trackingHelper.sendAdWordsEvent();break;case"custom_url":trackingHelper.sendAdWordsEvent(function(){window.top.location.href=REG.thankyouurl});break;default:document.cookie="gaThankYouEmail="+email,trackingHelper.sendTrackingEvent(),trackingHelper.sendAdWordsEvent(function(){window.top.location.href=REG.thankyouurl})}}},FormElement.prototype.reportValidity=function(){var oThis=this,fieldsName=Object.keys(this.errors||{});return fieldsName.forEach(function(name){if(oThis[name])oThis[name].reportValidity(oThis.errors[name]);else{var strippedName=name.replace("custom_","");oThis[strippedName]&&oThis[strippedName].reportValidity(oThis.errors[name])}}),!!fieldsName.length},Forms.prototype={register:function(element){var oThis=this,formSelectors=['div[data-editable="webform"] > form','[data-editable="webformNew"] form','[data-editable="webinarNew"] form'],formElements=element?[element]:document.querySelectorAll(formSelectors.join(", "));(ARRAY.slice.call(formElements)||[]).forEach(function(formElement){var form=new FormElement(formElement);ARRAY.push.call(oThis,form),oThis[name]=form})},namedItem:function(name){return this[name]}},(new Forms).register();var logLoadingTime=function(){};document.addEventListener("DOMContentLoaded",function(){var publish=!1;try{publish=parent&&parent.APP&&parent.APP.publish}catch(error){}var previewElement=document.getElementById("Preview");window.IFRUID&&(stopYTAutoPlay(),setMinHeightWhenOneSection()),publish&&publish("outsideFn",{type:"setPreviewOutside",width:previewElement.outerWidth,height:previewElement.outerHeight,sid:previewElement.getAttribute("data-id"),location:window.location.search.split("?")[1]||!1,zoom:APP.initialData.zoom})},!1),window.addEventListener("load",function(){!function(){document.body.addEventListener("click",function(e){var target=e.target,isButton="A"===target.nodeName&&"button"===target.parentNode.getAttribute("data-editable"),isImage="IMG"===target.nodeName&&"multimedia:image"===target.parentNode.parentNode.getAttribute("data-editable"),isText="A"===target.nodeName&&"text"===target.parentNode.parentNode.getAttribute("data-editable"),isPayPalButton=isButton&&"paypalbutton"===target.parentNode.getAttribute("data-type");if((isButton||isText||isImage)&&!isPayPalButton){var linkElement=isButton||isText?target:isImage?target.parentNode:null,$scrollToElement=$(linkElement.getAttribute("href"));e.preventDefault(),$("html, body").animate({scrollTop:$scrollToElement.offset().top},1e3)}},!1),function(){var $customIframe=$('body [data-editable="customIframe"]'),src=$customIframe.attr("data-src");$customIframe.html('<iframe src="'+src+'"></iframe>')}(),function(){if("true"!==$("body").attr("data-optimize-phone")){var styleTag=document.createElement("link");styleTag.type="text/css",styleTag.rel="stylesheet",styleTag.href=REG.url_to_old_mobile_styles,(document.head||document.getElementsByTagName("head")[0]).appendChild(styleTag)}}(),function(){$('[data-editable="customCode"] [data-editable-item="caption-wrapper"]').remove(),$('[data-editable="customCode"] [data-editable-item="code"]').each(function(index,code){var $code=$(code);$code.html($code.text()),$code.css({display:"block"})})}()}(),function(){var DblClickEl=document.querySelectorAll('[data-name="ff-dbl-click"]'),ln=DblClickEl.length,i;for(i=0;i<ln;i+=1){var el=DblClickEl[i];el.parentNode.removeChild(el)}}(),function(){$(document).on("mouseover",'[data-editable="button"]',function(e){$(e.currentTarget).addClass("hover")}).on("mouseout",'[data-editable="button"]',function(e){$(e.currentTarget).removeClass("hover")})}(),function(){var html,wrapper,preview=document.getElementById("Preview");window.parent&&Function.prototype.delay&&preview&&(html=document.documentElement,wrapper=document.querySelector('[data-section="wrap"]'),parent.postMessage.delay(100,parent,[{call:"init",brand:"LPS",IFRUID:window.IFRUID,display:{width:wrapper.offsetWidth,height:(preview?preview.offsetHeight:0)||(html?Math.max(html.scrollHeight,html.offsetHeight,html.clientHeight):0)}},"*"]))}()},!1)}(),function(){"use strict";function updateViewport(){var lpsWidth=deviceWidth<=600?parseInt(document.body.getAttribute("data-workspace-phone-width"),10)||400:parseInt(document.body.getAttribute("data-workspace-desktop-width"),10)||980,calculatedScale=deviceWidth/lpsWidth,viewportContent="initial-scale="+calculatedScale+", width=device-width, user-scalable=no";deviceWidth>=lpsWidth&&(viewportContent="initial-scale=1.0, "+"width=device-width, "+"user-scalable=no"),document.querySelector('meta[name="viewport"]').content=viewportContent}var orientation,deviceWidth,deviceHeight,startDimensions={};$(document).ready(function(){var screenOrientation=screen.webkitOrientation||screen.orientation&&screen.orientation.type;orientation=-1!==(screenOrientation||"").indexOf("portrait")?"portrait":"landscape",startDimensions[orientation]={width:window.screen.width,height:window.screen.height},startDimensions["portrait"===orientation?"landscape":"portrait"]={width:window.screen.height,height:window.screen.width},deviceWidth=window.screen.width,deviceHeight=window.screen.height,console.log("start",JSON.stringify(startDimensions)),updateViewport()}),window.addEventListener("orientationchange",function(){orientation="portrait"===orientation?"landscape":"portrait",deviceWidth=startDimensions[orientation].width,deviceHeight=startDimensions[orientation].height,console.log(orientation,deviceWidth,deviceHeight),updateViewport()})}();